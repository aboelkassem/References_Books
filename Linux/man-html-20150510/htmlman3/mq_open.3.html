<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <title>mq_open(3) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="mq_open(3) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve">
</script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>

<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>

          <th rowspan="1" colspan="1"><a href="../index3.html" shape="rect">Section 3</a></th>

          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>

  <div class="refentry">
    <a id="mq-open.3" name="mq-open.3" shape="rect"> </a>

    <div class="titlepage"> </div>

    <div class="refnamediv">
      <h2>Name</h2>

      <p>mq_open — open a message queue</p>
    </div>

    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>

      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#include &lt;fcntl.h&gt;            /* For O_* constants */
#include &lt;sys/stat.h&gt;         /* For mode constants */
#include &lt;mqueue.h&gt;
</pre>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">mqd_t
            <strong>mq_open</strong>(</code></td>

            <td rowspan="1" colspan="1">const char *<var class="pdparam">name</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">int <var class="pdparam">oflag</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">mqd_t
            <strong>mq_open</strong>(</code></td>

            <td rowspan="1" colspan="1">const char *<var class="pdparam">name</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">int <var class="pdparam">oflag</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">mode_t <var class="pdparam">mode</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">struct mq_attr *<var class="pdparam">attr</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25" colspan="1">
            <img alt="[Note]" src="../stylesheet/note.png" /></td>

            <th align="left" rowspan="1" colspan="1">Note</th>
          </tr>

          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <p>Link with <code class="option">−lrt</code>.</p>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="refsect1">
      <a id="mq-open-3_sect1" name="mq-open-3_sect1" shape="rect"> </a>

      <h2>DESCRIPTION</h2>

      <p><code class="function">mq_open</code>() creates a new
      POSIX message queue or opens an existing queue. The queue is
      identified by <em class="parameter"><code>name</code></em>.
      For details of the construction of <em class="parameter"><code>name</code></em>, see <a class="link" href="../htmlman7/mq_overview.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_overview</span>(7)</span></a>.</p>

      <p>The <em class="parameter"><code>oflag</code></em> argument
      specifies flags that control the operation of the call.
      (Definitions of the flags values can be obtained by including
      <code class="literal">&lt;</code><code class="filename">fcntl.h</code><code class="literal">&gt;</code>
      Exactly one of the following must be specified in <em class="parameter"><code>oflag</code></em>:</p>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="constant">O_RDONLY</code></span></dt>

          <dd>
            <p>Open the queue to receive messages only.</p>
          </dd>

          <dt><span class="term"><code class="constant">O_WRONLY</code></span></dt>

          <dd>
            <p>Open the queue to send messages only.</p>
          </dd>

          <dt><span class="term"><code class="constant">O_RDWR</code></span></dt>

          <dd>
            <p>Open the queue to both send and receive
            messages.</p>
          </dd>
        </dl>
      </div>

      <p>Zero or more of the following flags can additionally be
      <code class="constant">OR</code>ed in <em class="parameter"><code>oflag</code></em>:</p>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="constant">O_CLOEXEC</code> (since Linux
          2.6.26)</span></dt>

          <dd>
            <p>Set the close-on-exec flag for the message queue
            descriptor. See <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open</span>(2)</span></a> for a
            discussion of why this flag is useful.</p>
          </dd>

          <dt><span class="term"><code class="constant">O_CREAT</code></span></dt>

          <dd>
            <p>Create the message queue if it does not exist. The
            owner (user ID) of the message queue is set to the
            effective user ID of the calling process. The group
            ownership (group ID) is set to the effective group ID
            of the calling process.</p>
          </dd>

          <dt><span class="term"><code class="constant">O_EXCL</code></span></dt>

          <dd>
            <p>If <code class="constant">O_CREAT</code> was
            specified in <em class="parameter"><code>oflag</code></em>, and a queue with
            the given <em class="parameter"><code>name</code></em>
            already exists, then fail with the error <span class="errorname">EEXIST</span>.</p>
          </dd>

          <dt><span class="term"><code class="constant">O_NONBLOCK</code></span></dt>

          <dd>
            <p>Open the queue in nonblocking mode. In circumstances
            where <a class="link" href="../htmlman3/mq_receive.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_receive</span>(3)</span></a> and
            <a class="link" href="../htmlman3/mq_send.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_send</span>(3)</span></a> would
            normally block, these functions instead fail with the
            error <span class="errorname">EAGAIN</span>.</p>
          </dd>
        </dl>
      </div>

      <p>If <code class="constant">O_CREAT</code> is specified in
      <em class="parameter"><code>oflag</code></em>, then two
      additional arguments must be supplied. The <em class="parameter"><code>mode</code></em> argument specifies the
      permissions to be placed on the new queue, as for <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open</span>(2)</span></a>. (Symbolic
      definitions for the permissions bits can be obtained by
      including <code class="literal">&lt;</code><code class="filename">sys/stat.h</code><code class="literal">&gt;</code>
      The permissions settings are masked against the process
      umask.</p>

      <p>The <em class="parameter"><code>attr</code></em> argument
      specifies attributes for the queue. See <a class="link" href="../htmlman3/mq_getattr.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_getattr</span>(3)</span></a> for details.
      If <em class="parameter"><code>attr</code></em> is NULL, then
      the queue is created with implementation-defined default
      attributes. Since Linux 3.5, two <code class="filename">/proc</code> files can be used to control these
      defaults; see <a class="link" href="../htmlman7/mq_overview.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_overview</span>(7)</span></a> for
      details.</p>
    </div>

    <div class="refsect1">
      <a id="mq-open-3_sect2" name="mq-open-3_sect2" shape="rect"> </a>

      <h2>RETURN VALUE</h2>

      <p>On success, <code class="function">mq_open</code>()
      returns a message queue descriptor for use by other message
      queue functions. On error, <code class="function">mq_open</code>() returns <span class="emphasis"><em>(mqd_t) −1</em></span>, with
      <code class="varname">errno</code> set to indicate the
      error.</p>
    </div>

    <div class="refsect1">
      <a id="mq-open-3_sect3" name="mq-open-3_sect3" shape="rect"> </a>

      <h2>ERRORS</h2>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">EACCES</span></span></dt>

          <dd>
            <p>The queue exists, but the caller does not have
            permission to open it in the specified mode.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EACCES</span></span></dt>

          <dd>
            <p><em class="parameter"><code>name</code></em>
            contained more than one slash.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EEXIST</span></span></dt>

          <dd>
            <p>Both <code class="constant">O_CREAT</code> and
            <code class="constant">O_EXCL</code> were specified in
            <em class="parameter"><code>oflag</code></em>, but a
            queue with this <em class="parameter"><code>name</code></em> already exists.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p><em class="parameter"><code>name</code></em> doesn't
            follow the format in <a class="link" href="../htmlman7/mq_overview.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_overview</span>(7)</span></a>.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p><code class="constant">O_CREAT</code> was specified
            in <em class="parameter"><code>oflag</code></em>, and
            <em class="parameter"><code>attr</code></em> was not
            NULL, but <em class="replaceable"><code>attr−&gt;mq_maxmsg</code></em>
            or <em class="replaceable"><code>attr−&gt;mq_msqsize</code></em>
            was invalid. Both of these fields must be greater than
            zero. In a process that is unprivileged (does not have
            the <code class="constant">CAP_SYS_RESOURCE</code>
            capability), <em class="replaceable"><code>attr−&gt;mq_maxmsg</code></em>
            must be less than or equal to the <code class="constant">msg_max</code> limit, and <em class="replaceable"><code>attr−&gt;mq_msgsize</code></em>
            must be less than or equal to the <code class="constant">msgsize_max</code> limit. In addition, even
            in a privileged process, <em class="replaceable"><code>attr−&gt;mq_maxmsg</code></em>
            cannot exceed the <code class="constant">HARD_MAX</code> limit. (See <a class="link" href="../htmlman7/mq_overview.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_overview</span>(7)</span></a> for
            details of these limits.)</p>
          </dd>

          <dt><span class="term"><span class="errorname">EMFILE</span></span></dt>

          <dd>
            <p>The process already has the maximum number of files
            and message queues open.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENAMETOOLONG</span></span></dt>

          <dd>
            <p><em class="parameter"><code>name</code></em> was too
            long.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENFILE</span></span></dt>

          <dd>
            <p>The system limit on the total number of open files
            and message queues has been reached.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOENT</span></span></dt>

          <dd>
            <p>The <code class="constant">O_CREAT</code> flag was
            not specified in <em class="parameter"><code>oflag</code></em>, and no queue with
            this <em class="parameter"><code>name</code></em>
            exists.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOENT</span></span></dt>

          <dd>
            <p><em class="parameter"><code>name</code></em> was
            just "/" followed by no other characters.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOMEM</span></span></dt>

          <dd>
            <p>Insufficient memory.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOSPC</span></span></dt>

          <dd>
            <p>Insufficient space for the creation of a new message
            queue. This probably occurred because the <code class="constant">queues_max</code> limit was encountered; see
            <a class="link" href="../htmlman7/mq_overview.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_overview</span>(7)</span></a>.</p>
          </dd>
        </dl>
      </div>
    </div>

    <div class="refsect1">
      <a id="mq-open-3_sect4" name="mq-open-3_sect4" shape="rect"> </a>

      <h2>ATTRIBUTES</h2>

      <p>For an explanation of the terms used in this section, see
      <a class="link" href="../htmlman7/attributes.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">attributes</span>(7)</span></a>.</p>

      <div class="informaltable">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col class="c0" span="1" />
            <col class="c1" span="1" />
            <col class="c2" span="1" />
          </colgroup>

          <tbody>
            <tr>
              <td style="" align="left" rowspan="1" colspan="1">Interface</td>

              <td style="" align="left" rowspan="1" colspan="1">Attribute</td>

              <td style="" align="left" rowspan="1" colspan="1">Value</td>
            </tr>

            <tr>
              <td style="" align="left" rowspan="1" colspan="1"><code class="literal">mq_open</code>()</td>

              <td style="" align="left" rowspan="1" colspan="1">Thread safety</td>

              <td style="" align="left" rowspan="1" colspan="1">MT-Safe</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="refsect1">
      <a id="mq-open-3_sect5" name="mq-open-3_sect5" shape="rect"> </a>

      <h2>CONFORMING TO</h2>

      <p>POSIX.1-2001.</p>
    </div>

    <div class="refsect1">
      <a id="mq-open-3_sect6" name="mq-open-3_sect6" shape="rect"> </a>

      <h2>NOTES</h2>

      <div class="refsect2">
        <a id="mq-open-3_sect7" name="mq-open-3_sect7" shape="rect"> </a>

        <h3>C library/kernel ABI differences</h3>

        <p>The <code class="function">mq_open</code>() library
        function is implemented on top of a system call of the same
        name. The library function performs the check that the
        <em class="parameter"><code>name</code></em> starts with a
        slash (/), giving the <span class="errorname">EINVAL</span>
        error if it does not. The kernel system call expects
        <em class="parameter"><code>name</code></em> to contain no
        preceding slash, so the C library function passes
        <em class="parameter"><code>name</code></em> without the
        preceding slash (i.e., <em class="replaceable"><code>name+1</code></em>) to the system
        call.</p>
      </div>
    </div>

    <div class="refsect1">
      <a id="mq-open-3_sect8" name="mq-open-3_sect8" shape="rect"> </a>

      <h2>BUGS</h2>

      <p>In kernels before 2.6.14, the process umask was not
      applied to the permissions specified in <em class="parameter"><code>mode</code></em>.</p>
    </div>

    <div class="refsect1">
      <a id="mq-open-3_sect9" name="mq-open-3_sect9" shape="rect"> </a>

      <h2>SEE ALSO</h2>

      <p><a class="link" href="../htmlman3/mq_close.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_close</span>(3)</span></a>, <a class="link" href="../htmlman3/mq_getattr.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_getattr</span>(3)</span></a>, <a class="link" href="../htmlman3/mq_notify.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_notify</span>(3)</span></a>, <a class="link" href="../htmlman3/mq_receive.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_receive</span>(3)</span></a>, <a class="link" href="../htmlman3/mq_send.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_send</span>(3)</span></a>, <a class="link" href="../htmlman3/mq_unlink.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_unlink</span>(3)</span></a>, <a class="link" href="../htmlman7/mq_overview.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_overview</span>(7)</span></a></p>
    </div>

    <div class="colophon">
      <a id="mq-open-3_sect10" name="mq-open-3_sect10" shape="rect"> </a>

      <h2>COLOPHON</h2>

      <p>This page is part of release 4.00 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man−pages/.</p>

      <div class="license">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>

          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    t<br />
                  Copyright (C) 2006 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  <br />
                  %%%LICENSE_START(VERBATIM)<br />
                  Permission is granted to make and distribute verbatim copies of this<br />

                  manual provided the copyright notice and this permission notice are<br />

                  preserved on all copies.<br />
                  <br />
                  Permission is granted to copy and distribute modified versions of this<br />

                  manual under the conditions for verbatim copying, provided that the<br />

                  entire resulting derived work is distributed under the terms of a<br />

                  permission notice identical to this one.<br />

                  <br />
                  Since the Linux kernel and libraries are constantly changing, this<br />

                  manual page may be incorrect or out-of-date.  The author(s) assume no<br />

                  responsibility for errors or omissions, or for damages resulting from<br />

                  the use of the information contained herein.  The author(s) may not<br />

                  have taken the same level of care in the production of this manual,<br />

                  which is licensed free of charge, as they might when working<br />

                  professionally.<br />
                  <br />
                  Formatted or processed versions of this manual, if unaccompanied by<br />

                  the source, must acknowledge the copyright and authors of this work.<br />

                  %%%LICENSE_END<br />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
