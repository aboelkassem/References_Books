<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <title>fmemopen(3) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="fmemopen(3) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve">
</script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>

<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>

          <th rowspan="1" colspan="1"><a href="../index3.html" shape="rect">Section 3</a></th>

          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>

  <div class="refentry">
    <a id="fmemopen.3" name="fmemopen.3" shape="rect"> </a>

    <div class="titlepage"> </div>

    <div class="refnamediv">
      <h2>Name</h2>

      <p>fmemopen, open_memstream, open_wmemstream — open
      memory as stream</p>
    </div>

    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>

      <div class="funcsynopsis">
        <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;stdio.h&gt;
</pre>

        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">FILE
            *<strong>fmemopen</strong>(</code></td>

            <td rowspan="1" colspan="1">void *<var class="pdparam">buf</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">size_t <var class="pdparam">size</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">const char *<var class="pdparam">mode</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">FILE
            *<strong>open_memstream</strong>(</code></td>

            <td rowspan="1" colspan="1">char **<var class="pdparam">ptr</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">size_t *<var class="pdparam">sizeloc</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;wchar.h&gt;
</pre>

        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">FILE
            *<strong>open_wmemstream</strong>(</code></td>

            <td rowspan="1" colspan="1">wchar_t **<var class="pdparam">ptr</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">size_t *<var class="pdparam">sizeloc</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25" colspan="1">
            <img alt="[Note]" src="../stylesheet/note.png" /></td>

            <th align="left" rowspan="1" colspan="1">Note</th>
          </tr>

          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <div class="featuretests">
                <table style="border-collapse: collapse;">
                  <colgroup span="1">
                    <col span="1" />
                  </colgroup>

                  <thead>
                    <tr>
                      <th style="" rowspan="1" colspan="1">Feature Test Macro Requirements
                      for glibc (see <a class="link" href="../htmlman7/feature_test_macros.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">feature_test_macros</span>(7)</span></a>):</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr>
                      <td style="" rowspan="1" colspan="1"><code class="function">fmemopen</code>(), <code class="function">open_memstream</code>(),
                      <code class="function">open_wmemstream</code>():</td>
                    </tr>

                    <tr>
                      <td class="featuretestver" style="" rowspan="1" colspan="1">Since
                      glibc 2.10:</td>
                    </tr>

                    <tr>
                      <td class="featuretestdef" style="" rowspan="1" colspan="1">
                      <code class="constant">_XOPEN_SOURCE</code>
                      &gt;= 700 || <code class="constant">_POSIX_C_SOURCE</code> &gt;=
                      200809L</td>
                    </tr>

                    <tr>
                      <td class="featuretestver" style="" rowspan="1" colspan="1">Before
                      glibc 2.10:</td>
                    </tr>

                    <tr>
                      <td class="featuretestdef" style="" rowspan="1" colspan="1">
                      <code class="constant">_GNU_SOURCE</code></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect1" name="fmemopen-3_sect1" shape="rect"> </a>

      <h2>DESCRIPTION</h2>

      <p>The <code class="function">fmemopen</code>() function
      opens a stream that permits the access specified by
      <em class="parameter"><code>mode</code></em>. The stream
      allows I/O to be performed on the string or memory buffer
      pointed to by <em class="parameter"><code>buf</code></em>.
      This buffer must be at least <em class="parameter"><code>size</code></em> bytes long.</p>

      <p>The argument <em class="parameter"><code>mode</code></em>
      is the same as for <a class="link" href="../htmlman3/fopen.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fopen</span>(3)</span></a>. If <em class="parameter"><code>mode</code></em> specifies an append mode,
      then the initial file position is set to the location of the
      first null byte ('\0') in the buffer; otherwise the initial
      file position is set to the start of the buffer. Since glibc
      2.9, the letter 'b' may be specified as the second character
      in <em class="parameter"><code>mode</code></em>. This
      provides "binary" mode: writes don't implicitly add a
      terminating null byte, and <a class="link" href="../htmlman3/fseek.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fseek</span>(3)</span></a> <code class="constant">SEEK_END</code> is relative to the end of the
      buffer (i.e., the value specified by the <em class="parameter"><code>size</code></em> argument), rather than the
      current string length.</p>

      <p>When a stream that has been opened for writing is flushed
      (<a class="link" href="../htmlman3/fflush.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fflush</span>(3)</span></a>) or closed
      (<a class="link" href="../htmlman3/fclose.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fclose</span>(3)</span></a>), a null byte is
      written at the end of the buffer if there is space. The
      caller should ensure that an extra byte is available in the
      buffer (and that <em class="parameter"><code>size</code></em>
      counts that byte) to allow for this.</p>

      <p>Attempts to write more than <em class="parameter"><code>size</code></em> bytes to the buffer result
      in an error. (By default, such errors will be visible only
      when the <code class="function">stdio</code> buffer is
      flushed. Disabling buffering with the following call may be
      useful to detect errors at the time of an output
      operation:</p>

      <p>setbuf(stdream, NULL);</p>

      <p>Alternatively, the caller can explicitly set <em class="parameter"><code>buf</code></em> as the stdio stream buffer,
      at the same time informing stdio of the buffer's size,
      using:</p>

      <p>setbuffer(stream, buf, size);</p>

      <p>In a stream opened for reading, null bytes ('\0') in the
      buffer do not cause read operations to return an end-of-file
      indication. A read from the buffer will indicate end-of-file
      only when the file pointer advances <em class="parameter"><code>size</code></em> bytes past the start of
      the buffer.</p>

      <p>If <em class="parameter"><code>buf</code></em> is
      specified as NULL, then <code class="function">fmemopen</code>() dynamically allocates a buffer
      <em class="parameter"><code>size</code></em> bytes long. This
      is useful for an application that wants to write data to a
      temporary buffer and then read it back again. The buffer is
      automatically freed when the stream is closed. Note that the
      caller has no way to obtain a pointer to the temporary buffer
      allocated by this call (but see <code class="function">open_memstream</code>() below).</p>

      <p>The <code class="function">open_memstream</code>()
      function opens a stream for writing to a buffer. The buffer
      is dynamically allocated (as with <a class="link" href="../htmlman3/malloc.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">malloc</span>(3)</span></a>), and
      automatically grows as required. After closing the stream,
      the caller should <a class="link" href="../htmlman3/malloc.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">free</span>(3)</span></a> this buffer.</p>

      <p>When the stream is closed (<a class="link" href="../htmlman3/fclose.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fclose</span>(3)</span></a>) or flushed
      (<a class="link" href="../htmlman3/fflush.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fflush</span>(3)</span></a>), the locations
      pointed to by <em class="parameter"><code>ptr</code></em> and
      <em class="parameter"><code>sizeloc</code></em> are updated
      to contain, respectively, a pointer to the buffer and the
      current size of the buffer. These values remain valid only as
      long as the caller performs no further output on the stream.
      If further output is performed, then the stream must again be
      flushed before trying to access these variables.</p>

      <p>A null byte is maintained at the end of the buffer. This
      byte is <span class="emphasis"><em>not</em></span> included
      in the size value stored at <em class="parameter"><code>sizeloc</code></em>.</p>

      <p>The stream's file position can be changed with <a class="link" href="../htmlman3/fseek.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fseek</span>(3)</span></a> or <a class="link" href="../htmlman3/fseeko.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fseeko</span>(3)</span></a>. Moving the file
      position past the end of the data already written fills the
      intervening space with zeros.</p>

      <p>The <code class="function">open_wmemstream</code>() is
      similar to <code class="function">open_memstream</code>(),
      but operates on wide characters instead of bytes.</p>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect2" name="fmemopen-3_sect2" shape="rect"> </a>

      <h2>RETURN VALUE</h2>

      <p>Upon successful completion <code class="function">fmemopen</code>(), <code class="function">open_memstream</code>() and <code class="function">open_wmemstream</code>() return a <span class="type">FILE</span> pointer. Otherwise, NULL is returned and
      <code class="varname">errno</code> is set to indicate the
      error.</p>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect3" name="fmemopen-3_sect3" shape="rect"> </a>

      <h2>VERSIONS</h2>

      <p><code class="function">fmemopen</code>() and <code class="function">open_memstream</code>() were already available in
      glibc 1.0.x. <code class="function">open_wmemstream</code>()
      is available since glibc 2.4.</p>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect4" name="fmemopen-3_sect4" shape="rect"> </a>

      <h2>ATTRIBUTES</h2>

      <p>For an explanation of the terms used in this section, see
      <a class="link" href="../htmlman7/attributes.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">attributes</span>(7)</span></a>.</p>

      <div class="informaltable">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col class="c0" span="1" />
            <col class="c1" span="1" />
            <col class="c2" span="1" />
          </colgroup>

          <tbody>
            <tr>
              <td style="" align="left" rowspan="1" colspan="1">Interface</td>

              <td style="" align="left" rowspan="1" colspan="1">Attribute</td>

              <td style="" align="left" rowspan="1" colspan="1">Value</td>
            </tr>

            <tr>
              <td style="" align="left" rowspan="1" colspan="1"><code class="literal">fopenmem</code>(),<span style="color: red">&lt;br&gt;&lt;/br&gt;</span><code class="literal">open_memstream</code>(),<span style="color: red">&lt;br&gt;&lt;/br&gt;</span>
              <code class="literal">open_wmemstream</code></td>

              <td style="" align="left" rowspan="1" colspan="1">Thread safety</td>

              <td style="" align="left" rowspan="1" colspan="1">MT-Safe</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect5" name="fmemopen-3_sect5" shape="rect"> </a>

      <h2>CONFORMING TO</h2>

      <p>POSIX.1-2008. These functions are not specified in
      POSIX.1-2001, and are not widely available on other
      systems.</p>

      <p>POSIX.1-2008 specifies that 'b' in <em class="parameter"><code>mode</code></em> shall be ignored. However,
      Technical Corrigendum 1 adjusts the standard to allow
      implementation-specific treatment for this case, thus
      permitting the glibc treatment of 'b'.</p>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect6" name="fmemopen-3_sect6" shape="rect"> </a>

      <h2>NOTES</h2>

      <p>There is no file descriptor associated with the file
      stream returned by these functions (i.e., <a class="link" href="../htmlman3/ferror.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fileno</span>(3)</span></a> will return an
      error if called on the returned stream).</p>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect7" name="fmemopen-3_sect7" shape="rect"> </a>

      <h2>BUGS</h2>

      <p>In glibc before version 2.7, seeking past the end of a
      stream created by <code class="function">open_memstream</code>() does not enlarge the
      buffer; instead the <a class="link" href="../htmlman3/fseek.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fseek</span>(3)</span></a> call fails,
      returning −1.</p>

      <p>If <em class="parameter"><code>size</code></em> is
      specified as zero, <code class="function">fmemopen</code>()
      fails with the error <span class="errorname">EINVAL</span>.
      It would be more consistent if this case successfully created
      a stream that then returned end of file on the first attempt
      at reading. Furthermore, POSIX.1-2008 does not specify a
      failure for this case.</p>

      <p>Specifying append mode ("a" or "a+") for <code class="function">fmemopen</code>() sets the initial file position
      to the first null byte, but (if the file offset is reset to a
      location other than the end of the stream) does not force
      subsequent writes to append at the end of the stream.</p>

      <p>If the <em class="parameter"><code>mode</code></em>
      argument to <code class="function">fmemopen</code>()
      specifies append ("a" or "a+"), and the <em class="parameter"><code>size</code></em> argument does not cover a
      null byte in <em class="parameter"><code>buf</code></em>,
      then, according to POSIX.1-2008, the initial file position
      should be set to the next byte after the end of the buffer.
      However, in this case the glibc <code class="function">fmemopen</code>() sets the file position to
      −1.</p>

      <p>To specify binary mode for <code class="function">fmemopen</code>() the 'b' must be the <code class="function">second</code> character in <em class="parameter"><code>mode</code></em>. Thus, for example, "wb+"
      has the desired effect, but "w+b" does not. This is
      inconsistent with the treatment of <em class="parameter"><code>mode</code></em> by <a class="link" href="../htmlman3/fopen.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fopen</span>(3)</span></a>.</p>

      <p>The glibc 2.9 addition of "binary" mode for <code class="function">fmemopen</code>() silently changed the ABI:
      previously, <code class="function">fmemopen</code>() ignored
      'b' in <em class="parameter"><code>mode</code></em>.</p>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect8" name="fmemopen-3_sect8" shape="rect"> </a>

      <h2>EXAMPLE</h2>

      <p>The program below uses <code class="function">fmemopen</code>() to open an input buffer, and
      <code class="function">open_memstream</code>() to open a
      dynamically sized output buffer. The program scans its input
      string (taken from the program's first command-line argument)
      reading integers, and writes the squares of these integers to
      the output buffer. An example of the output produced by this
      program is the following:</p>

      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$<span class="emphasis"><em> ./a.out '1 23 43'</em></span>
size=11; ptr=1 529 1849
</pre>
          </div>
        </blockquote>
      </div>

      <div class="refsect2">
        <a id="fmemopen-3_sect9" name="fmemopen-3_sect9" shape="rect"> </a>

        <h3>Program source</h3>

        <div class="informalexample">
          <pre class="programlisting" xml:space="preserve">
#define _GNU_SOURCE
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

#define handle_error(msg) \
    do { perror(msg); exit(EXIT_FAILURE); } while (0)

int
main(int argc, char *argv[])
{
    FILE *out, *in;
    int v, s;
    size_t size;
    char *ptr;

    if (argc != 2) {
        fprintf(stderr, "Usage: %s &lt;file&gt;\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    in = fmemopen(argv[1], strlen(argv[1]), "r");
    if (in == NULL)
        handle_error("fmemopen");

    out = open_memstream(&amp;ptr, &amp;size);
    if (out == NULL)
        handle_error("open_memstream");

    for (;;) {
        s = fscanf(in, "%d", &amp;v);
        if (s &lt;= 0)
            break;

        s = fprintf(out, "%d ", v * v);
        if (s == −1)
            handle_error("fprintf");
    }
    fclose(in);
    fclose(out);
    printf("size=%zu; ptr=%s\n", size, ptr);
    free(ptr);
    exit(EXIT_SUCCESS);
}
</pre>
        </div>
      </div>
    </div>

    <div class="refsect1">
      <a id="fmemopen-3_sect10" name="fmemopen-3_sect10" shape="rect"> </a>

      <h2>SEE ALSO</h2>

      <p><a class="link" href="../htmlman3/fopen.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fopen</span>(3)</span></a>, <a class="link" href="../htmlman3/fopencookie.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fopencookie</span>(3)</span></a></p>
    </div>

    <div class="colophon">
      <a id="fmemopen-3_sect11" name="fmemopen-3_sect11" shape="rect"> </a>

      <h2>COLOPHON</h2>

      <p>This page is part of release 4.00 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man−pages/.</p>

      <div class="license">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>

          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright 2005 walter harms (walter.harms<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>informatik.uni-oldenburg.de),<br />

                  and Copyright 2005, 2012 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  <br />
                  %%%LICENSE_START(GPL_NOVERSION_ONELINE)<br />
                  Distributed under the GPL.<br />
                  %%%LICENSE_END<br />
                  <br />
                  2008-12-04, Petr Baudis &lt;pasky<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>suse.cz&gt;: Document open_wmemstream()<br />
                  
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
