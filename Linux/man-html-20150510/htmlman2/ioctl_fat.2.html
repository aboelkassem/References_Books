<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <title>ioctl-fat(2) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="ioctl-fat(2) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve">
</script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>

<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>

          <th rowspan="1" colspan="1"><a href="../index2.html" shape="rect">Section 2</a></th>

          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>

  <div class="refentry">
    <a id="ioctl-fat.2" name="ioctl-fat.2" shape="rect"> </a>

    <div class="titlepage"> </div>

    <div class="refnamediv">
      <h2>Name</h2>

      <p>ioctl_fat — manipulating the FAT filesystem</p>
    </div>

    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>

      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#include &lt;linux/msdos_fs.h&gt;
#include &lt;sys/ioctl.h&gt;
</pre>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>ioctl</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">fd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1"><var class="pdparam">FAT_IOCTL_GET_ATTRIBUTES</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">uint32_t * <var class="pdparam">attr</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>ioctl</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">fd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1"><var class="pdparam">FAT_IOCTL_SET_ATTRIBUTES</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">uint32_t * <var class="pdparam">attr</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>ioctl</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">fd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1"><var class="pdparam">FAT_IOCTL_GET_VOLUME_ID</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">uint32_t * <var class="pdparam">id</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>ioctl</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">fd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1"><var class="pdparam">VFAT_IOCTL_READDIR_BOTH</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">struct __fat_dirent[2] <var class="pdparam">entry</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>ioctl</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">fd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1"><var class="pdparam">VFAT_IOCTL_READDIR_SHORT</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">struct __fat_dirent[2] <var class="pdparam">entry</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>
    </div>

    <div class="refsect1">
      <a id="ioctl-fat-2_sect1" name="ioctl-fat-2_sect1" shape="rect"> </a>

      <h2>DESCRIPTION</h2>

      <p>The <a class="link" href="../htmlman2/ioctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a> system call can be
      used to read and write metadata of FAT filesystems that are
      not accessible using other system calls.</p>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect2" name="ioctl-fat-2_sect2" shape="rect"> </a>

        <h3>Reading and setting file attributes</h3>

        <p>Files and directories in the FAT filesystem possess an
        attribute bit mask that can be read with <em class="parameter"><code>FAT_IOCTL_GET_ATTRIBUTES</code></em> and
        written with <em class="parameter"><code>FAT_IOCTL_SET_ATTRIBUTES</code></em>.</p>

        <p>The <em class="parameter"><code>fd</code></em> argument
        contains a file descriptor for a file or directory. It is
        sufficient to create the file descriptor by calling
        <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open</span>(2)</span></a> with the
        <code class="constant">O_RDONLY</code> flag.</p>

        <p>The <em class="parameter"><code>attr</code></em>
        argument contains a pointer to a bit mask. The bits of the
        bit mask are:</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="constant">ATTR_RO</code></span></dt>

            <dd>
              <p>This bit specifies that the file or directory is
              read-only.</p>
            </dd>

            <dt><span class="term"><code class="constant">ATTR_HIDDEN</code></span></dt>

            <dd>
              <p>This bit specifies that the file or directory is
              hidden.</p>
            </dd>

            <dt><span class="term"><code class="constant">ATTR_SYS</code></span></dt>

            <dd>
              <p>This bit specifies that the file is a system
              file.</p>
            </dd>

            <dt><span class="term"><code class="constant">ATTR_VOLUME</code></span></dt>

            <dd>
              <p>This bit specifies that the file is a volume
              label. This attribute is read-only.</p>
            </dd>

            <dt><span class="term"><code class="constant">ATTR_DIR</code></span></dt>

            <dd>
              <p>This bit specifies that this is a directory. This
              attribute is read-only.</p>
            </dd>

            <dt><span class="term"><code class="constant">ATTR_ARCH</code></span></dt>

            <dd>
              <p>This bit indicates that this file or directory
              should be archived. It is set when a file is created
              or modified. It is reset by an archiving system.</p>
            </dd>
          </dl>
        </div>

        <p>The zero value <code class="constant">ATTR_NONE</code>
        can be used to indicate that no attribute bit is set.</p>
      </div>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect3" name="ioctl-fat-2_sect3" shape="rect"> </a>

        <h3>Reading the volume label</h3>

        <p>FAT filesystems are identified by a volume label. The
        volume label can be read with <em class="parameter"><code>FAT_IOCTL_GET_VOLUME_ID</code></em>.</p>

        <p>The <em class="parameter"><code>fd</code></em> argument
        can be a file descriptor for any file or directory of the
        filesystem. It is sufficient to create the file descriptor
        by calling <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open</span>(2)</span></a> with the
        <code class="constant">O_RDONLY</code> flag.</p>

        <p>The <em class="parameter"><code>id</code></em> argument
        is a pointer to the field that will be filled with the
        volume ID. Typically the volume label is displayed to the
        user as a group of two 16-bit fields:</p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
printf("Volume ID %4x-%4x\n", id &gt;&gt; 16, id &amp; 0xFFFF);
</pre>
            </div>
          </blockquote>
        </div>
      </div>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect4" name="ioctl-fat-2_sect4" shape="rect"> </a>

        <h3>Reading short file names of a directory</h3>

        <p>A file or directory on a FAT filesystem always has a
        short filename consisting of up to 8 capital letters,
        optionally followed by a period and up to 3 capital letters
        for the file extension. If the actual filename does not fit
        into this scheme, it is stored as a long filename of up to
        255 UTF-16 characters.</p>

        <p>The short filenames in a directory can be read with
        <em class="parameter"><code>VFAT_IOCTL_READDIR_SHORT</code></em>.
        <em class="parameter"><code>VFAT_IOCTL_READDIR_BOTH</code></em> reads
        both the short and the long filenames.</p>

        <p>The <em class="parameter"><code>fd</code></em> argument
        must be a file descriptor for a directory. It is sufficient
        to create the file descriptor by calling <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open</span>(2)</span></a> with the
        <code class="constant">O_RDONLY</code> flag. The file
        descriptor can be used only once to iterate over the
        directory entries by calling <a class="link" href="../htmlman2/ioctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a> repeatedly.</p>

        <p>The <em class="parameter"><code>entry</code></em>
        argument is a two-element array of the following
        structures:</p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>

                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>

                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">__fat_dirent</span> {</td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">long</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>d_ino</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__kernel_off_t</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>d_off</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">uint32_t short</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>d_reclen</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">char</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>d_name</code></em>[256];</td>

                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>

                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>

        <p>The first entry in the array is for the short filename.
        The second entry is for the long filename.</p>

        <p>The <em class="parameter"><code>d_ino</code></em> and
        <em class="parameter"><code>d_off</code></em> fields are
        filled only for long filenames. The <em class="parameter"><code>d_ino</code></em> field holds the inode
        number of the directory. The <em class="parameter"><code>d_off</code></em> field holds the offset
        of the file entry in the directory. As these values are not
        available for short filenames, the user code should simply
        ignore them.</p>

        <p>The field <em class="parameter"><code>d_reclen</code></em> contains the length
        of the filename in the field <em class="parameter"><code>d_name</code></em>. To keep backward
        compatibility, a length of 0 for the short filename signals
        that the end of the directory has been reached. However,
        the preferred method for detecting the end of the directory
        is to test the <code class="function">ioctl</code>() return
        value. If no long filename exists, field <em class="parameter"><code>d_reclen</code></em> is set to 0 and
        <em class="parameter"><code>d_name</code></em> is a
        character string of length 0 for the long filename.</p>
      </div>
    </div>

    <div class="refsect1">
      <a id="ioctl-fat-2_sect5" name="ioctl-fat-2_sect5" shape="rect"> </a>

      <h2>RETURN VALUE</h2>

      <p>On error, −1 is returned, and <code class="varname">errno</code> is set to indicate the error.</p>

      <p>For <em class="parameter"><code>VFAT_IOCTL_READDIR_BOTH</code></em> and
      <em class="parameter"><code>VFAT_IOCTL_READDIR_SHORT</code></em> a
      return value of 1 signals that a new directory entry has been
      read and a return value of 0 signals that the end of the
      directory has been reached.</p>
    </div>

    <div class="refsect1">
      <a id="ioctl-fat-2_sect6" name="ioctl-fat-2_sect6" shape="rect"> </a>

      <h2>ERRORS</h2>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">ENOENT</span></span></dt>

          <dd>
            <p>This error is returned by <em class="parameter"><code>VFAT_IOCTL_READDIR_BOTH</code></em>
            and <em class="parameter"><code>VFAT_IOCTL_READDIR_SHORT</code></em>
            if the file descriptor <em class="parameter"><code>fd</code></em> refers to a removed,
            but still open directory.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOTDIR</span></span></dt>

          <dd>
            <p>This error is returned by <em class="parameter"><code>VFAT_IOCTL_READDIR_BOTH</code></em>
            and <em class="parameter"><code>VFAT_IOCTL_READDIR_SHORT</code></em>
            if the file descriptor <em class="parameter"><code>fd</code></em> does not refer to a
            directory.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOTTY</span></span></dt>

          <dd>
            <p>The file descriptor <em class="parameter"><code>fd</code></em> does not refer to an
            object in a FAT filesystem.</p>
          </dd>
        </dl>
      </div>

      <p>For further error values, see <a class="link" href="../htmlman2/ioctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a>.</p>
    </div>

    <div class="refsect1">
      <a id="ioctl-fat-2_sect7" name="ioctl-fat-2_sect7" shape="rect"> </a>

      <h2>VERSIONS</h2>

      <p><em class="parameter"><code>VFAT_IOCTL_READDIR_BOTH</code></em> and
      <em class="parameter"><code>VFAT_IOCTL_READDIR_SHORT</code></em> first
      appeared in Linux 2.0.</p>

      <p><em class="parameter"><code>FAT_IOCTL_GET_ATTRIBUTES</code></em> and
      <em class="parameter"><code>FAT_IOCTL_SET_ATTRIBUTES</code></em> first
      appeared in Linux 2.6.12.</p>

      <p><em class="parameter"><code>FAT_IOCTL_GET_VOLUME_ID</code></em> was
      introduced in version 3.11 of the Linux kernel.</p>
    </div>

    <div class="refsect1">
      <a id="ioctl-fat-2_sect8" name="ioctl-fat-2_sect8" shape="rect"> </a>

      <h2>CONFORMING TO</h2>

      <p>This API is Linux-specific.</p>
    </div>

    <div class="refsect1">
      <a id="ioctl-fat-2_sect9" name="ioctl-fat-2_sect9" shape="rect"> </a>

      <h2>EXAMPLE</h2>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect10" name="ioctl-fat-2_sect10" shape="rect"> </a>

        <h3>Toggling the archive flag</h3>

        <p>The following program demonstrates the usage of
        <code class="function">ioctl</code>() to manipulate file
        attributes. The program reads and displays the archive
        attribute of a file. After inverting the value of the
        attribute, the program reads and displays the attribute
        again.</p>

        <p>The following was recorded when applying the program for
        the file <code class="filename">/mnt/user/foo<code class="literal">:</code></code></p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
# ./toggle_fat_archive_flag /mnt/user/foo
Archive flag is set
Toggling archive flag
Archive flag is not set
</pre>
            </div>
          </blockquote>
        </div>
      </div>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect11" name="ioctl-fat-2_sect11" shape="rect"> </a>

        <h3>Program source (toggle_fat_archive_flag.c)</h3>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
#include &lt;fcntl.h&gt;
#include &lt;linux/msdos_fs.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;unistd.h&gt;

/*
 * Read file attributes of a file on a FAT filesystem.
 * Output the state of the archive flag.
 */
static uint32_t
readattr(int fd)
{
    uint32_t attr;
    int ret;

    ret = ioctl(fd, FAT_IOCTL_GET_ATTRIBUTES, &amp;attr);
    if (ret == −1) {
        perror("ioctl");
        exit(EXIT_FAILURE);
    }

    if (attr &amp; ATTR_ARCH)
        printf("Archive flag is set\n");
    else
        printf("Archive flag is not set\n");

    return attr;
}

int
main(int argc, char *argv[])
{
    uint32_t attr;
    int fd;
    int ret;

    if (argc != 2) {
        printf("Usage: %s FILENAME\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    fd = open(argv[1], O_RDONLY);
    if (fd == −1) {
        perror("open");
        exit(EXIT_FAILURE);
    }

    /*
     * Read and display the FAT file attributes.
     */
    attr = readattr(fd);

    /*
     * Invert archive attribute.
     */
    printf("Toggling archive flag\n");
    attr ^= ATTR_ARCH;

    /*
     * Write the changed FAT file attributes.
     */
    ret = ioctl(fd, FAT_IOCTL_SET_ATTRIBUTES, &amp;attr);
    if (ret == −1) {
        perror("ioctl");
        exit(EXIT_FAILURE);
    }

    /*
     * Read and display the FAT file attributes.
     */
    readattr(fd);

    close(fd);

    exit(EXIT_SUCCESS);
}
</pre>
            </div>
          </blockquote>
        </div>
      </div>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect12" name="ioctl-fat-2_sect12" shape="rect"> </a>

        <h3>Reading the volume label</h3>

        <p>The following program demonstrates the use of <a class="link" href="../htmlman2/ioctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a> to display the
        volume label of a FAT filesystem.</p>

        <p>The following output was recorded when applying the
        program for directory <code class="filename">/mnt/user<code class="literal">:</code></code></p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
$ ./display_fat_volume_id /mnt/user
Volume ID 6443-6241
</pre>
            </div>
          </blockquote>
        </div>
      </div>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect13" name="ioctl-fat-2_sect13" shape="rect"> </a>

        <h3>Program source (display_fat_volume_id.c)</h3>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
#include &lt;fcntl.h&gt;
#include &lt;linux/msdos_fs.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;unistd.h&gt;

int
main(int argc, char *argv[])
{
    uint32_t id;
    int fd;
    int ret;

    if (argc != 2) {
        printf("Usage: %s FILENAME\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    fd = open(argv[1], O_RDONLY);
    if (fd == −1) {
        perror("open");
        exit(EXIT_FAILURE);
    }

    /*
     * Read volume ID.
     */
    ret = ioctl(fd, FAT_IOCTL_GET_VOLUME_ID, &amp;id);
    if (ret == −1) {
        perror("ioctl");
        exit(EXIT_FAILURE);
    }

    /*
     * Format the output as two groups of 16 bits each.
     */
    printf("Volume ID %4x−%4x\n", id &gt;&gt; 16, id &amp; 0xFFFF);

    close(fd);

    exit(EXIT_SUCCESS);
}
</pre>
            </div>
          </blockquote>
        </div>
      </div>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect14" name="ioctl-fat-2_sect14" shape="rect"> </a>

        <h3>Listing a directory</h3>

        <p>The following program demonstrates the use of <a class="link" href="../htmlman2/ioctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a> to list a
        directory.</p>

        <p>The following was recorded when applying the program to
        the directory <code class="filename">/mnt/user<code class="literal">:</code></code></p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
$ ./fat_dir /mnt/user
[char46] -&gt; ''
[char46]. -&gt; ''
ALONGF~1.TXT -&gt; 'a long filename.txt'
UPPER.TXT -&gt; ''
LOWER.TXT -&gt; 'lower.txt'
</pre>
            </div>
          </blockquote>
        </div>
      </div>

      <div class="refsect2">
        <a id="ioctl-fat-2_sect15" name="ioctl-fat-2_sect15" shape="rect"> </a>

        <h3>Program source</h3>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
#include &lt;fcntl.h&gt;
#include &lt;linux/msdos_fs.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;unistd.h&gt;

int
main(int argc, char *argv[])
{
    struct __fat_dirent entry[2];
    int fd;
    int ret;

    if (argc != 2) {
        printf("Usage: %s DIRECTORY\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    /*
     * Open file descriptor for the directory.
     */
    fd = open(argv[1], O_RDONLY | O_DIRECTORY);
    if (fd == −1) {
        perror("open");
        exit(EXIT_FAILURE);
    }

    for (;;) {

        /*
         * Read next directory entry.
         */
        ret = ioctl( fd, VFAT_IOCTL_READDIR_BOTH, entry);

        /*
         * If an error occurs, the return value is −1.
         * If the end of the directory list has been reached,
         * the return value is 0.
         * For backward compatibility the end of the directory
         * list is also signaled by d_reclen == 0.
         */
        if (ret &lt; 1)
            break;

        /*
         * Write both the short name and the long name.
         */
        printf("%s −&gt; '%s'\n", entry[0].d_name, entry[1].d_name);
    }

    if (ret == −1) {
        perror("VFAT_IOCTL_READDIR_BOTH");
        exit(EXIT_FAILURE);
    }

    /*
     * Close the file descriptor.
     */
    close(fd);

    exit(EXIT_SUCCESS);
}
</pre>
            </div>
          </blockquote>
        </div>
      </div>
    </div>

    <div class="refsect1">
      <a id="ioctl-fat-2_sect16" name="ioctl-fat-2_sect16" shape="rect"> </a>

      <h2>SEE ALSO</h2>

      <p><a class="link" href="../htmlman2/ioctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a></p>
    </div>

    <div class="colophon">
      <a id="ioctl-fat-2_sect17" name="ioctl-fat-2_sect17" shape="rect"> </a>

      <h2>COLOPHON</h2>

      <p>This page is part of release 4.00 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man−pages/.</p>

      <div class="license">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>

          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright (C) 2014, Heinrich Schuchardt &lt;xypron.glpk<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmx.de&gt;<br />

                  <br />
                  %%%LICENSE_START(VERBATIM)<br />
                  Permission is granted to make and distribute verbatim copies of this<br />

                  manual provided the copyright notice and this permission notice are<br />

                  preserved on all copies.<br />
                  <br />
                  Permission is granted to copy and distribute modified versions of<br />

                  this manual under the conditions for verbatim copying, provided that<br />

                  the entire resulting derived work is distributed under the terms of<br />

                  a permission notice identical to this one.<br />

                  <br />
                  Since the Linux kernel and libraries are constantly changing, this<br />

                  manual page may be incorrect or out-of-date.  The author(s) assume<br />

                  no responsibility for errors or omissions, or for damages resulting<br />

                  from the use of the information contained herein.  The author(s) may<br />

                  not have taken the same level of care in the production of this<br />

                  manual, which is licensed free of charge, as they might when working<br />

                  professionally.<br />
                  <br />
                  Formatted or processed versions of this manual, if unaccompanied by<br />

                  the source, must acknowledge the copyright and authors of this work.<br />

                  %%%LICENSE_END<br />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
