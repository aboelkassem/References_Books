<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <title>timerfd_create(2) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="timerfd_create(2) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve">
</script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>

<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>

          <th rowspan="1" colspan="1"><a href="../index2.html" shape="rect">Section 2</a></th>

          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>

  <div class="refentry">
    <a id="timerfd-create.2" name="timerfd-create.2" shape="rect"> </a>

    <div class="titlepage"> </div>

    <div class="refnamediv">
      <h2>Name</h2>

      <p>timerfd_create, timerfd_settime, timerfd_gettime —
      timers that notify via file descriptors</p>
    </div>

    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>

      <div class="funcsynopsis">
        <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;sys/timerfd.h&gt;
</pre>

        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>timerfd_create</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">clockid</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">int <var class="pdparam">flags</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>timerfd_settime</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">fd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">int <var class="pdparam">flags</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">const struct itimerspec *<var class="pdparam">new_value</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">struct itimerspec *<var class="pdparam">old_value</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>timerfd_gettime</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">fd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">struct itimerspec *<var class="pdparam">curr_value</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>
    </div>

    <div class="refsect1">
      <a id="timerfd-create-2_sect1" name="timerfd-create-2_sect1" shape="rect"> </a>

      <h2>DESCRIPTION</h2>

      <p>These system calls create and operate on a timer that
      delivers timer expiration notifications via a file
      descriptor. They provide an alternative to the use of
      <a class="link" href="../htmlman2/getitimer.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">setitimer</span>(2)</span></a> or <a class="link" href="../htmlman2/timer_create.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_create</span>(2)</span></a>, with the
      advantage that the file descriptor may be monitored by
      <a class="link" href="../htmlman2/select.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">select</span>(2)</span></a>, <a class="link" href="../htmlman2/poll.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">poll</span>(2)</span></a>, and <a class="link" href="../htmlman7/epoll.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">epoll</span>(7)</span></a>.</p>

      <p>The use of these three system calls is analogous to the
      use of <a class="link" href="../htmlman2/timer_create.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_create</span>(2)</span></a>, <a class="link" href="../htmlman2/timer_settime.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_settime</span>(2)</span></a>, and
      <a class="link" href="../htmlman2/timer_settime.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_gettime</span>(2)</span></a>. (There is
      no analog of <a class="link" href="../htmlman2/timer_getoverrun.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_getoverrun</span>(2)</span></a>, since
      that functionality is provided by <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a>, as described
      below.)</p>

      <div class="refsect2">
        <a id="timerfd-create-2_sect2" name="timerfd-create-2_sect2" shape="rect"> </a>

        <h3>timerfd_create()</h3>

        <p><code class="function">timerfd_create</code>() creates a
        new timer object, and returns a file descriptor that refers
        to that timer. The <em class="parameter"><code>clockid</code></em> argument specifies
        the clock that is used to mark the progress of the timer,
        and must be either <code class="constant">CLOCK_REALTIME</code> or <code class="constant">CLOCK_MONOTONIC</code>. <code class="constant">CLOCK_REALTIME</code> is a settable system-wide
        clock. <code class="constant">CLOCK_MONOTONIC</code> is a
        nonsettable clock that is not affected by discontinuous
        changes in the system clock (e.g., manual changes to system
        time). The current value of each of these clocks can be
        retrieved using <a class="link" href="../htmlman2/clock_getres.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clock_gettime</span>(2)</span></a>.</p>

        <p>Starting with Linux 2.6.27, the following values may be
        bitwise ORed in <em class="parameter"><code>flags</code></em> to change the behavior
        of <code class="function">timerfd_create</code>():</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="constant">TFD_NONBLOCK</code></span></dt>

            <dd>
              <p>Set the <code class="constant">O_NONBLOCK</code>
              file status flag on the new open file description.
              Using this flag saves extra calls to <a class="link" href="../htmlman2/fcntl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fcntl</span>(2)</span></a> to achieve
              the same result.</p>
            </dd>

            <dt><span class="term"><code class="constant">TFD_CLOEXEC</code></span></dt>

            <dd>
              <p>Set the close-on-exec (<code class="constant">FD_CLOEXEC</code>) flag on the new file
              descriptor. See the description of the <code class="constant">O_CLOEXEC</code> flag in <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open</span>(2)</span></a> for reasons
              why this may be useful.</p>
            </dd>
          </dl>
        </div>

        <p>In Linux versions up to and including 2.6.26, <em class="parameter"><code>flags</code></em> must be specified as
        zero.</p>
      </div>

      <div class="refsect2">
        <a id="timerfd-create-2_sect3" name="timerfd-create-2_sect3" shape="rect"> </a>

        <h3>timerfd_settime()</h3>

        <p><code class="function">timerfd_settime</code>() arms
        (starts) or disarms (stops) the timer referred to by the
        file descriptor <em class="parameter"><code>fd</code></em>.</p>

        <p>The <em class="parameter"><code>new_value</code></em>
        argument specifies the initial expiration and interval for
        the timer. The <em class="replaceable"><code>itimer</code></em> structure used for
        this argument contains two fields, each of which is in turn
        a structure of type <em class="replaceable"><code>timespec</code></em>:</p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>

                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>

                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">timespec</span> {</td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">time_t</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>tv_sec</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        /* Seconds */
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">long</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>tv_nsec</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        /* Nanoseconds */
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>

                  <tr>
                    <td class="structsep" style="" colspan="5" align="left" rowspan="1"></td>
                  </tr>

                  <tr>
                    <td class="structdefhdr2" style="" align="left" rowspan="1" colspan="1">struct</td>

                    <td class="structdefhdr2" style="" colspan="4" align="left" rowspan="1"><span class="structname">itimerspec</span> {</td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">struct timespec</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>it_interval</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* Interval for periodic timer */
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">struct timespec</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>it_value</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* Initial expiration */
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>

        <p><em class="replaceable"><code>new_value.it_value</code></em>
        specifies the initial expiration of the timer, in seconds
        and nanoseconds. Setting either field of <em class="replaceable"><code>new_value.it_value</code></em> to a
        nonzero value arms the timer. Setting both fields of
        <em class="replaceable"><code>new_value.it_value</code></em> to zero
        disarms the timer.</p>

        <p>Setting one or both fields of <em class="replaceable"><code>new_value.it_interval</code></em> to
        nonzero values specifies the period, in seconds and
        nanoseconds, for repeated timer expirations after the
        initial expiration. If both fields of <em class="replaceable"><code>new_value.it_interval</code></em> are
        zero, the timer expires just once, at the time specified by
        <em class="replaceable"><code>new_value.it_value</code></em>.</p>

        <p>The <em class="parameter"><code>flags</code></em>
        argument is either 0, to start a relative timer (<em class="replaceable"><code>new_value.it_value</code></em>
        specifies a time relative to the current value of the clock
        specified by <em class="parameter"><code>clockid</code></em>), or <code class="constant">TFD_TIMER_ABSTIME</code>, to start an absolute
        timer (<em class="replaceable"><code>new_value.it_value</code></em>
        specifies an absolute time for the clock specified by
        <em class="parameter"><code>clockid</code></em>; that is,
        the timer will expire when the value of that clock reaches
        the value specified in <em class="replaceable"><code>new_value.it_value</code></em>).</p>

        <p>If the <em class="parameter"><code>old_value</code></em>
        argument is not NULL, then the <span class="structname">itimerspec</span> structure that it points to
        is used to return the setting of the timer that was current
        at the time of the call; see the description of
        <code class="function">timerfd_gettime</code>()
        following.</p>
      </div>

      <div class="refsect2">
        <a id="timerfd-create-2_sect4" name="timerfd-create-2_sect4" shape="rect"> </a>

        <h3>timerfd_gettime()</h3>

        <p><code class="function">timerfd_gettime</code>() returns,
        in <em class="parameter"><code>curr_value</code></em>, an
        <span class="structname">itimerspec</span> structure that
        contains the current setting of the timer referred to by
        the file descriptor <em class="parameter"><code>fd</code></em>.</p>

        <p>The <em class="parameter"><code>it_value</code></em>
        field returns the amount of time until the timer will next
        expire. If both fields of this structure are zero, then the
        timer is currently disarmed. This field always contains a
        relative value, regardless of whether the <code class="constant">TFD_TIMER_ABSTIME</code> flag was specified when
        setting the timer.</p>

        <p>The <em class="parameter"><code>it_interval</code></em>
        field returns the interval of the timer. If both fields of
        this structure are zero, then the timer is set to expire
        just once, at the time specified by <em class="replaceable"><code>curr_value.it_value</code></em>.</p>
      </div>

      <div class="refsect2">
        <a id="timerfd-create-2_sect5" name="timerfd-create-2_sect5" shape="rect"> </a>

        <h3>Operating on a timer file descriptor</h3>

        <p>The file descriptor returned by <code class="function">timerfd_create</code>() supports the following
        operations:</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="function">read</code>(<em class="parameter"><code>2</code></em>)</span></dt>

            <dd>
              <p>If the timer has already expired one or more times
              since its settings were last modified using
              <code class="function">timerfd_settime</code>(), or
              since the last successful <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a>, then the
              buffer given to <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a> returns an
              unsigned 8-byte integer (<span class="type">uint64_t</span>) containing the number of
              expirations that have occurred. (The returned value
              is in host byte order—that is, the native byte
              order for integers on the host machine.)</p>

              <p>If no timer expirations have occurred at the time
              of the <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a>, then the
              call either blocks until the next timer expiration,
              or fails with the error <span class="errorname">EAGAIN</span> if the file descriptor has
              been made nonblocking (via the use of the <a class="link" href="../htmlman2/fcntl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fcntl</span>(2)</span></a>
              <code class="constant">F_SETFL</code> operation to
              set the <code class="constant">O_NONBLOCK</code>
              flag).</p>

              <p>A <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a> will fail
              with the error <span class="errorname">EINVAL</span>
              if the size of the supplied buffer is less than 8
              bytes.</p>
            </dd>

            <dt><span class="term"><code class="function">poll</code>(<em class="parameter"><code>2)</code></em>, <em class="parameter"><code>select(2) (and
            similar</code></em>)</span></dt>

            <dd>
              <p>The file descriptor is readable (the <a class="link" href="../htmlman2/select.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">select</span>(2)</span></a>
              <em class="replaceable"><code>readfds</code></em>
              argument; the <a class="link" href="../htmlman2/poll.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">poll</span>(2)</span></a>
              <code class="constant">POLLIN</code> flag) if one or
              more timer expirations have occurred.</p>

              <p>The file descriptor also supports the other
              file-descriptor multiplexing APIs: <a class="link" href="../htmlman2/select.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">pselect</span>(2)</span></a>,
              <a class="link" href="../htmlman2/poll.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ppoll</span>(2)</span></a>, and
              <a class="link" href="../htmlman7/epoll.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">epoll</span>(7)</span></a>.</p>
            </dd>

            <dt><span class="term"><code class="function">ioctl</code>(<em class="parameter"><code>2</code></em>)</span></dt>

            <dd>
              <p>The following timerfd-specific command is
              supported:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">TFD_IOC_SET_TICKS</code> (since
                      Linux 3.17)</span></dt>

                      <dd>
                        <p>Adjust the number of timer expirations
                        that have occurred. The argument is a
                        pointer to a nonzero 8-byte integer
                        (<span class="type">uint64_t</span>*)
                        containing the new number of expirations.
                        Once the number is set, any waiter on the
                        timer is woken up. The only purpose of this
                        command is to restore the expirations for
                        the purpose of checkpoint/restore. This
                        operation is available only if the kernel
                        was configured with the <code class="constant">CONFIG_CHECKPOINT_RESTORE</code>
                        option.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><code class="function">close</code>(<em class="parameter"><code>2</code></em>)</span></dt>

            <dd>
              <p>When the file descriptor is no longer required it
              should be closed. When all file descriptors
              associated with the same timer object have been
              closed, the timer is disarmed and its resources are
              freed by the kernel.</p>
            </dd>
          </dl>
        </div>
      </div>

      <div class="refsect2">
        <a id="timerfd-create-2_sect6" name="timerfd-create-2_sect6" shape="rect"> </a>

        <h3>fork(2) semantics</h3>

        <p>After a <a class="link" href="../htmlman2/fork.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fork</span>(2)</span></a>, the child
        inherits a copy of the file descriptor created by
        <code class="function">timerfd_create</code>(). The file
        descriptor refers to the same underlying timer object as
        the corresponding file descriptor in the parent, and
        <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a>s in the child
        will return information about expirations of the timer.</p>
      </div>

      <div class="refsect2">
        <a id="timerfd-create-2_sect7" name="timerfd-create-2_sect7" shape="rect"> </a>

        <h3>execve(2) semantics</h3>

        <p>A file descriptor created by <code class="function">timerfd_create</code>() is preserved across
        <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>, and continues
        to generate timer expirations if the timer was armed.</p>
      </div>
    </div>

    <div class="refsect1">
      <a id="timerfd-create-2_sect8" name="timerfd-create-2_sect8" shape="rect"> </a>

      <h2>RETURN VALUE</h2>

      <p>On success, <code class="function">timerfd_create</code>()
      returns a new file descriptor. On error, −1 is returned
      and <code class="varname">errno</code> is set to indicate the
      error.</p>

      <p><code class="function">timerfd_settime</code>() and
      <code class="function">timerfd_gettime</code>() return 0 on
      success; on error they return −1, and set <code class="varname">errno</code> to indicate the error.</p>
    </div>

    <div class="refsect1">
      <a id="timerfd-create-2_sect9" name="timerfd-create-2_sect9" shape="rect"> </a>

      <h2>ERRORS</h2>

      <p><code class="function">timerfd_create</code>() can fail
      with the following errors:</p>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p>The <em class="parameter"><code>clockid</code></em>
            argument is neither <code class="constant">CLOCK_MONOTONIC</code> nor <code class="constant">CLOCK_REALTIME</code>;</p>
          </dd>

          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p><em class="parameter"><code>flags</code></em> is
            invalid; or, in Linux 2.6.26 or earlier, <em class="parameter"><code>flags</code></em> is nonzero.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EMFILE</span></span></dt>

          <dd>
            <p>The per-process limit of open file descriptors has
            been reached.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENFILE</span></span></dt>

          <dd>
            <p>The system-wide limit on the total number of open
            files has been reached.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENODEV</span></span></dt>

          <dd>
            <p>Could not mount (internal) anonymous inode
            device.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOMEM</span></span></dt>

          <dd>
            <p>There was insufficient kernel memory to create the
            timer.</p>
          </dd>
        </dl>
      </div>

      <p><code class="function">timerfd_settime</code>() and
      <code class="function">timerfd_gettime</code>() can fail with
      the following errors:</p>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">EBADF</span></span></dt>

          <dd>
            <p><em class="parameter"><code>fd</code></em> is not a
            valid file descriptor.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EFAULT</span></span></dt>

          <dd>
            <p><em class="parameter"><code>new_value</code></em>,
            <em class="parameter"><code>old_value</code></em>, or
            <em class="parameter"><code>curr_value</code></em> is
            not valid a pointer.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p><em class="parameter"><code>fd</code></em> is not a
            valid timerfd file descriptor.</p>
          </dd>
        </dl>
      </div>

      <p><code class="function">timerfd_settime</code>() can also
      fail with the following errors:</p>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p><em class="parameter"><code>new_value</code></em> is
            not properly initialized (one of the <em class="parameter"><code>tv_nsec</code></em> falls outside the
            range zero to 999,999,999).</p>
          </dd>

          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p><em class="parameter"><code>flags</code></em> is
            invalid.</p>
          </dd>
        </dl>
      </div>
    </div>

    <div class="refsect1">
      <a id="timerfd-create-2_sect10" name="timerfd-create-2_sect10" shape="rect"> </a>

      <h2>VERSIONS</h2>

      <p>These system calls are available on Linux since kernel
      2.6.25. Library support is provided by glibc since version
      2.8.</p>
    </div>

    <div class="refsect1">
      <a id="timerfd-create-2_sect11" name="timerfd-create-2_sect11" shape="rect"> </a>

      <h2>CONFORMING TO</h2>

      <p>These system calls are Linux-specific.</p>
    </div>

    <div class="refsect1">
      <a id="timerfd-create-2_sect12" name="timerfd-create-2_sect12" shape="rect"> </a>

      <h2>BUGS</h2>

      <p>Currently, <code class="function">timerfd_create</code>()
      supports fewer types of clock IDs than <a class="link" href="../htmlman2/timer_create.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_create</span>(2)</span></a>.</p>
    </div>

    <div class="refsect1">
      <a id="timerfd-create-2_sect13" name="timerfd-create-2_sect13" shape="rect"> </a>

      <h2>EXAMPLE</h2>

      <p>The following program creates a timer and then monitors
      its progress. The program accepts up to three command-line
      arguments. The first argument specifies the number of seconds
      for the initial expiration of the timer. The second argument
      specifies the interval for the timer, in seconds. The third
      argument specifies the number of times the program should
      allow the timer to expire before terminating. The second and
      third command-line arguments are optional.</p>

      <p>The following shell session demonstrates the use of the
      program:</p>

      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$<span class="emphasis"><em> a.out 3 1 100</em></span>
0.000: timer started
3.000: read: 1; total=1
4.000: read: 1; total=2
<code class="literal">^Z</code>                 # type control-Z to suspend the program
[1]+  Stopped                 ./timerfd3_demo 3 1 100
$ <em class="replaceable"><code>fg</code></em>                # Resume execution after a few seconds
a.out 3 1 100
9.660: read: 5; total=7
10.000: read: 1; total=8
11.000: read: 1; total=9
<code class="literal">^C</code>                 # type control-C to suspend the program
</pre>
          </div>
        </blockquote>
      </div>

      <div class="refsect2">
        <a id="timerfd-create-2_sect14" name="timerfd-create-2_sect14" shape="rect"> </a>

        <h3>Program source</h3>

        <div class="informalexample">
          <pre class="programlisting" xml:space="preserve">
#include &lt;sys/timerfd.h&gt;
#include &lt;time.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;        /* Definition of uint64_t */

#define handle_error(msg) \
        do { perror(msg); exit(EXIT_FAILURE); } while (0)

static void
print_elapsed_time(void)
{
    static struct timespec start;
    struct timespec curr;
    static int first_call = 1;
    int secs, nsecs;

    if (first_call) {
        first_call = 0;
        if (clock_gettime(CLOCK_MONOTONIC, &amp;start) == −1)
            handle_error("clock_gettime");
    }

    if (clock_gettime(CLOCK_MONOTONIC, &amp;curr) == −1)
        handle_error("clock_gettime");

    secs = curr.tv_sec − start.tv_sec;
    nsecs = curr.tv_nsec − start.tv_nsec;
    if (nsecs &lt; 0) {
        secs−−;
        nsecs += 1000000000;
    }
    printf("%d.%03d: ", secs, (nsecs + 500000) / 1000000);
}

int
main(int argc, char *argv[])
{
    struct itimerspec new_value;
    int max_exp, fd;
    struct timespec now;
    uint64_t exp, tot_exp;
    ssize_t s;

    if ((argc != 2) &amp;&amp; (argc != 4)) {
        fprintf(stderr, "%s init−secs [interval−secs max−exp]\n",
                argv[0]);
        exit(EXIT_FAILURE);
    }

    if (clock_gettime(CLOCK_REALTIME, &amp;now) == −1)
        handle_error("clock_gettime");

    /* Create a CLOCK_REALTIME absolute timer with initial
       expiration and interval as specified in command line */

    new_value.it_value.tv_sec = now.tv_sec + atoi(argv[1]);
    new_value.it_value.tv_nsec = now.tv_nsec;
    if (argc == 2) {
        new_value.it_interval.tv_sec = 0;
        max_exp = 1;
    } else {
        new_value.it_interval.tv_sec = atoi(argv[2]);
        max_exp = atoi(argv[3]);
    }
    new_value.it_interval.tv_nsec = 0;

    fd = timerfd_create(CLOCK_REALTIME, 0);
    if (fd == −1)
        handle_error("timerfd_create");

    if (timerfd_settime(fd, TFD_TIMER_ABSTIME, &amp;new_value, NULL) == −1)
        handle_error("timerfd_settime");

    print_elapsed_time();
    printf("timer started\n");

    for (tot_exp = 0; tot_exp &lt; max_exp;) {
        s = read(fd, &amp;exp, sizeof(uint64_t));
        if (s != sizeof(uint64_t))
            handle_error("read");

        tot_exp += exp;
        print_elapsed_time();
        printf("read: %llu; total=%llu\n",
                (unsigned long long) exp,
                (unsigned long long) tot_exp);
    }

    exit(EXIT_SUCCESS);
}
</pre>
        </div>
      </div>
    </div>

    <div class="refsect1">
      <a id="timerfd-create-2_sect15" name="timerfd-create-2_sect15" shape="rect"> </a>

      <h2>SEE ALSO</h2>

      <p><a class="link" href="../htmlman2/eventfd.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">eventfd</span>(2)</span></a>, <a class="link" href="../htmlman2/poll.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">poll</span>(2)</span></a>, <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a>, <a class="link" href="../htmlman2/select.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">select</span>(2)</span></a>, <a class="link" href="../htmlman2/getitimer.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">setitimer</span>(2)</span></a>, <a class="link" href="../htmlman2/signalfd.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">signalfd</span>(2)</span></a>, <a class="link" href="../htmlman2/timer_create.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_create</span>(2)</span></a>, <a class="link" href="../htmlman2/timer_settime.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_gettime</span>(2)</span></a>, <a class="link" href="../htmlman2/timer_settime.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_settime</span>(2)</span></a>, <a class="link" href="../htmlman7/epoll.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">epoll</span>(7)</span></a>, <a class="link" href="../htmlman7/time.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">time</span>(7)</span></a></p>
    </div>

    <div class="colophon">
      <a id="timerfd-create-2_sect16" name="timerfd-create-2_sect16" shape="rect"> </a>

      <h2>COLOPHON</h2>

      <p>This page is part of release 4.00 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man−pages/.</p>

      <div class="license">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>

          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright (C) 2008 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  <br />
                  %%%LICENSE_START(GPLv2+_SW_3_PARA)<br />
                  This program is free software; you can redistribute it and/or modify<br />

                  it under the terms of the GNU General Public License as published by<br />

                  the Free Software Foundation; either version 2 of the License, or<br />

                  (at your option) any later version.<br />

                  <br />
                  This program is distributed in the hope that it will be useful,<br />

                  but WITHOUT ANY WARRANTY; without even the implied warranty of<br />

                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the<br />

                  GNU General Public License for more details.<br />

                  <br />
                  You should have received a copy of the GNU General Public<br />

                  License along with this manual; if not, see<br />

                  &lt;<a class="literalurl" href="http://www.gnu.org/licenses/" target="_top" shape="rect">http://www.gnu.org/licenses/</a>&gt;.<br />

                  %%%LICENSE_END<br />
                  <br />
                  FIXME Linux 3.0: timerfd_settime() adds a TFD_TIMER_CANCEL_ON_SET flag;<br />

                  This flag needs to documented.<br />
                  
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
