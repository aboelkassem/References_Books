<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <title>msgctl(2) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="msgctl(2) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve">
</script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>

<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>

          <th rowspan="1" colspan="1"><a href="../index2.html" shape="rect">Section 2</a></th>

          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>

  <div class="refentry">
    <a id="msgctl.2" name="msgctl.2" shape="rect"> </a>

    <div class="titlepage"> </div>

    <div class="refnamediv">
      <h2>Name</h2>

      <p>msgctl — System V message control operations</p>
    </div>

    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>

      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;
</pre>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>msgctl</strong>(</code></td>

            <td rowspan="1" colspan="1">int <var class="pdparam">msqid</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">int <var class="pdparam">cmd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">struct msqid_ds *<var class="pdparam">buf</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>
    </div>

    <div class="refsect1">
      <a id="msgctl-2_sect1" name="msgctl-2_sect1" shape="rect"> </a>

      <h2>DESCRIPTION</h2>

      <p><code class="function">msgctl</code>() performs the
      control operation specified by <em class="parameter"><code>cmd</code></em> on the System V message
      queue with identifier <em class="parameter"><code>msqid</code></em>.</p>

      <p>The <span class="structname">msqid_ds</span> data
      structure is defined in <code class="literal">&lt;</code><code class="filename">sys/msg.h</code><code class="literal">&gt;</code>
      as follows:</p>

      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="structdef">
            <table style="border-collapse: collapse;">
              <colgroup span="1">
                <col class="c1" span="1" />
                <col class="c2" span="1" />
                <col class="c3" span="1" />
                <col class="c4" span="1" />
                <col class="c5" span="1" />
              </colgroup>

              <tbody>
                <tr>
                  <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                  struct</td>

                  <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">msqid_ds</span> {</td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">struct ipc_perm</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msg_perm</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Ownership and permissions */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">time_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msg_stime</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Time of last msgsnd(2) */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">time_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msg_rtime</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Time of last msgrcv(2) */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">time_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msg_ctime</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Time of last change */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">unsigned long</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>__msg_cbytes</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Current number of bytes in<br />

                      queue (nonstandard) */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">msgqnum_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msg_qnum</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Current number of messages<br />

                      in queue */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">msglen_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msg_qbytes</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Maximum number of bytes<br />

                      allowed in queue */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">pid_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msg_lspid</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* PID of last msgsnd(2) */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">pid_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msg_lrpid</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* PID of last msgrcv(2) */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                </tr>
              </tbody>
            </table>
          </div>
        </blockquote>
      </div>

      <p>The <em class="replaceable"><code>ipc_perm</code></em>
      structure is defined as follows (the highlighted fields are
      settable using <code class="constant">IPC_SET</code>):</p>

      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="structdef">
            <table style="border-collapse: collapse;">
              <colgroup span="1">
                <col class="c1" span="1" />
                <col class="c2" span="1" />
                <col class="c3" span="1" />
                <col class="c4" span="1" />
                <col class="c5" span="1" />
              </colgroup>

              <tbody>
                <tr>
                  <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                  struct</td>

                  <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">ipc_perm</span> {</td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">key_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>__key</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Key supplied to msgget(2) */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">uid_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>uid</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Effective UID of owner */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">gid_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>gid</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Effective GID of owner */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">uid_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>cuid</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Effective UID of creator */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">gid_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>cgid</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Effective GID of creator */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">unsigned short</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>mode</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      /* Permissions */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">unsigned short</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>__seq</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      /* Sequence number */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                </tr>
              </tbody>
            </table>
          </div>
        </blockquote>
      </div>

      <p>Valid values for <em class="parameter"><code>cmd</code></em> are:</p>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="constant">IPC_STAT</code></span></dt>

          <dd>
            <p>Copy information from the kernel data structure
            associated with <em class="parameter"><code>msqid</code></em> into the
            <span class="structname">msqid_ds</span> structure
            pointed to by <em class="parameter"><code>buf</code></em>. The caller must have
            read permission on the message queue.</p>
          </dd>

          <dt><span class="term"><code class="constant">IPC_SET</code></span></dt>

          <dd>
            <p>Write the values of some members of the <span class="structname">msqid_ds</span> structure pointed to by
            <em class="parameter"><code>buf</code></em> to the
            kernel data structure associated with this message
            queue, updating also its <em class="parameter"><code>msg_ctime</code></em> member. The
            following members of the structure are updated:
            <em class="parameter"><code>msg_qbytes</code></em>,
            <em class="replaceable"><code>msg_perm.uid</code></em>,
            <em class="replaceable"><code>msg_perm.gid</code></em>,
            and (the least significant 9 bits of) <em class="replaceable"><code>msg_perm.mode</code></em>. The
            effective UID of the calling process must match the
            owner (<em class="replaceable"><code>msg_perm.uid</code></em>) or
            creator (<em class="replaceable"><code>msg_perm.cuid</code></em>) of the
            message queue, or the caller must be privileged.
            Appropriate privilege (Linux: the <code class="constant">CAP_SYS_RESOURCE</code> capability) is
            required to raise the <em class="parameter"><code>msg_qbytes</code></em> value beyond
            the system parameter <code class="constant">MSGMNB</code>.</p>
          </dd>

          <dt><span class="term"><code class="constant">IPC_RMID</code></span></dt>

          <dd>
            <p>Immediately remove the message queue, awakening all
            waiting reader and writer processes (with an error
            return and <code class="varname">errno</code> set to
            <span class="errorname">EIDRM</span>). The calling
            process must have appropriate privileges or its
            effective user ID must be either that of the creator or
            owner of the message queue. The third argument to
            <code class="function">msgctl</code>() is ignored in
            this case.</p>
          </dd>

          <dt><span class="term"><code class="constant">IPC_INFO</code> (Linux-specific)</span></dt>

          <dd>
            <p>Return information about system-wide message queue
            limits and parameters in the structure pointed to by
            <em class="parameter"><code>buf</code></em>. This
            structure is of type <em class="replaceable"><code>msginfo</code></em> (thus, a cast
            is required), defined in <code class="literal">&lt;</code><code class="filename">sys/msg.h</code><code class="literal">&gt;</code> if the <code class="constant">_GNU_SOURCE</code> feature test macro is
            defined:</p>

            <div class="blockquote">
              <blockquote class="blockquote">
                <div class="structdef">
                  <table style="border-collapse: collapse;">
                    <colgroup span="1">
                      <col class="c1" span="1" />
                      <col class="c2" span="1" />
                      <col class="c3" span="1" />
                      <col class="c4" span="1" />
                      <col class="c5" span="1" />
                    </colgroup>

                    <tbody>
                      <tr>
                        <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                        <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">msginfo</span> {</td>
                      </tr>

                      <tr>
                        <td style="" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><span class="type">int</span></td>

                        <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msgpool</code></em>;</td>

                        <td style="" align="left" rowspan="1" colspan="1">
                          <div class="literallayout">
                            
                            /* Size in kibibytes of buffer pool<br />

                            used to hold message data;<br />

                            unused within kernel */
                          </div>
                        </td>
                      </tr>

                      <tr>
                        <td style="" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><span class="type">int</span></td>

                        <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msgmap</code></em>;</td>

                        <td style="" align="left" rowspan="1" colspan="1">
                          <div class="literallayout">
                            
                            /* Maximum number of entries in message<br />

                            map; unused within kernel */
                          </div>
                        </td>
                      </tr>

                      <tr>
                        <td style="" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><span class="type">int</span></td>

                        <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msgmax</code></em>;</td>

                        <td style="" align="left" rowspan="1" colspan="1">
                          <div class="literallayout">
                            
                            /* Maximum number of bytes that can be<br />

                            written in a single message */
                          </div>
                        </td>
                      </tr>

                      <tr>
                        <td style="" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><span class="type">int</span></td>

                        <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msgmnb</code></em>;</td>

                        <td style="" align="left" rowspan="1" colspan="1">
                          <div class="literallayout">
                            
                            /* Maximum number of bytes that can be<br />

                            written to queue; used to initialize<br />

                            msg_qbytes during queue creation<br />

                            (msgget(2)) */
                          </div>
                        </td>
                      </tr>

                      <tr>
                        <td style="" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><span class="type">int</span></td>

                        <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msgmni</code></em>;</td>

                        <td style="" align="left" rowspan="1" colspan="1">
                          <div class="literallayout">
                            
                            /* Maximum number of message queues */
                          </div>
                        </td>
                      </tr>

                      <tr>
                        <td style="" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><span class="type">int</span></td>

                        <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msgssz</code></em>;</td>

                        <td style="" align="left" rowspan="1" colspan="1">
                          <div class="literallayout">
                            
                            /* Message segment size;<br />

                            unused within kernel */
                          </div>
                        </td>
                      </tr>

                      <tr>
                        <td style="" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><span class="type">int</span></td>

                        <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msgtql</code></em>;</td>

                        <td style="" align="left" rowspan="1" colspan="1">
                          <div class="literallayout">
                            
                            /* Maximum number of messages on all queues<br />

                            in system; unused within kernel */
                          </div>
                        </td>
                      </tr>

                      <tr>
                        <td style="" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><span class="type">unsigned short int</span></td>

                        <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                        <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>msgseg</code></em>;</td>

                        <td style="" align="left" rowspan="1" colspan="1">
                          <div class="literallayout">
                            
                            /* Maximum number of segments;<br />

                            unused within kernel */
                          </div>
                        </td>
                      </tr>

                      <tr>
                        <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </blockquote>
            </div>

            <p>The <em class="parameter"><code>msgmni</code></em>,
            <em class="parameter"><code>msgmax</code></em>, and
            <em class="parameter"><code>msgmnb</code></em> settings
            can be changed via <code class="filename">/proc</code>
            files of the same name; see <a class="link" href="../htmlman5/proc.5.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">proc</span>(5)</span></a> for
            details.</p>
          </dd>

          <dt><span class="term"><code class="constant">MSG_INFO</code> (Linux-specific)</span></dt>

          <dd>
            <p>Return a <em class="replaceable"><code>msginfo</code></em> structure
            containing the same information as for <code class="constant">IPC_INFO</code>, except that the following
            fields are returned with information about system
            resources consumed by message queues: the <em class="parameter"><code>msgpool</code></em> field returns the
            number of message queues that currently exist on the
            system; the <em class="parameter"><code>msgmap</code></em> field returns the
            total number of messages in all queues on the system;
            and the <em class="parameter"><code>msgtql</code></em>
            field returns the total number of bytes in all messages
            in all queues on the system.</p>
          </dd>

          <dt><span class="term"><code class="constant">MSG_STAT</code> (Linux-specific)</span></dt>

          <dd>
            <p>Return a <span class="structname">msqid_ds</span>
            structure as for <code class="constant">IPC_STAT</code>. However, the <em class="parameter"><code>msqid</code></em> argument is not a
            queue identifier, but instead an index into the
            kernel's internal array that maintains information
            about all message queues on the system.</p>
          </dd>
        </dl>
      </div>
    </div>

    <div class="refsect1">
      <a id="msgctl-2_sect2" name="msgctl-2_sect2" shape="rect"> </a>

      <h2>RETURN VALUE</h2>

      <p>On success, <code class="constant">IPC_STAT</code>,
      <code class="constant">IPC_SET</code>, and <code class="constant">IPC_RMID</code> return 0. A successful
      <code class="constant">IPC_INFO</code> or <code class="constant">MSG_INFO</code> operation returns the index of the
      highest used entry in the kernel's internal array recording
      information about all message queues. (This information can
      be used with repeated <code class="constant">MSG_STAT</code>
      operations to obtain information about all queues on the
      system.) A successful <code class="constant">MSG_STAT</code>
      operation returns the identifier of the queue whose index was
      given in <em class="parameter"><code>msqid</code></em>.</p>

      <p>On error, −1 is returned with <code class="varname">errno</code> indicating the error.</p>
    </div>

    <div class="refsect1">
      <a id="msgctl-2_sect3" name="msgctl-2_sect3" shape="rect"> </a>

      <h2>ERRORS</h2>

      <p>On failure, <code class="varname">errno</code> is set to
      one of the following:</p>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">EACCES</span></span></dt>

          <dd>
            <p>The argument <em class="parameter"><code>cmd</code></em> is equal to
            <code class="constant">IPC_STAT</code> or <code class="constant">MSG_STAT</code>, but the calling process
            does not have read permission on the message queue
            <em class="parameter"><code>msqid</code></em>, and does
            not have the <code class="constant">CAP_IPC_OWNER</code> capability.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EFAULT</span></span></dt>

          <dd>
            <p>The argument <em class="parameter"><code>cmd</code></em> has the value
            <code class="constant">IPC_SET</code> or <code class="constant">IPC_STAT</code>, but the address pointed to
            by <em class="parameter"><code>buf</code></em> isn't
            accessible.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EIDRM</span></span></dt>

          <dd>
            <p>The message queue was removed.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p>Invalid value for <em class="parameter"><code>cmd</code></em> or <em class="parameter"><code>msqid</code></em>. Or: for a
            <code class="constant">MSG_STAT</code> operation, the
            index value specified in <em class="parameter"><code>msqid</code></em> referred to an
            array slot that is currently unused.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EPERM</span></span></dt>

          <dd>
            <p>The argument <em class="parameter"><code>cmd</code></em> has the value
            <code class="constant">IPC_SET</code> or <code class="constant">IPC_RMID</code>, but the effective user ID
            of the calling process is not the creator (as found in
            <em class="replaceable"><code>msg_perm.cuid</code></em>) or the
            owner (as found in <em class="replaceable"><code>msg_perm.uid</code></em>) of the
            message queue, and the caller is not privileged (Linux:
            does not have the <code class="constant">CAP_SYS_ADMIN</code> capability).</p>
          </dd>

          <dt><span class="term"><span class="errorname">EPERM</span></span></dt>

          <dd>
            <p>An attempt (<code class="constant">IPC_SET</code>)
            was made to increase <em class="parameter"><code>msg_qbytes</code></em> beyond the
            system parameter <code class="constant">MSGMNB</code>,
            but the caller is not privileged (Linux: does not have
            the <code class="constant">CAP_SYS_RESOURCE</code>
            capability).</p>
          </dd>
        </dl>
      </div>
    </div>

    <div class="refsect1">
      <a id="msgctl-2_sect4" name="msgctl-2_sect4" shape="rect"> </a>

      <h2>CONFORMING TO</h2>

      <p>SVr4, POSIX.1-2001.</p>
    </div>

    <div class="refsect1">
      <a id="msgctl-2_sect5" name="msgctl-2_sect5" shape="rect"> </a>

      <h2>NOTES</h2>

      <p>The inclusion of <code class="literal">&lt;</code><code class="filename">sys/types.h</code><code class="literal">&gt;</code> and <code class="literal">&lt;</code><code class="filename">sys/ipc.h</code><code class="literal">&gt;</code>
      isn't required on Linux or by any version of POSIX. However,
      some old implementations required the inclusion of these
      header files, and the SVID also documented their inclusion.
      Applications intended to be portable to such old systems may
      need to include these header files.</p>

      <p>The <code class="constant">IPC_INFO</code>, <code class="constant">MSG_STAT</code> and <code class="constant">MSG_INFO</code> operations are used by the
      <a class="link" href="../htmlman1/ipcs.1.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ipcs</span>(1)</span></a> program to provide
      information on allocated resources. In the future these may
      modified or moved to a <code class="filename">/proc</code>
      filesystem interface.</p>

      <p>Various fields in the <span class="emphasis"><em>struct
      msqid_ds</em></span> were typed as <span class="type">short</span> under Linux 2.2 and have become
      <span class="type">long</span> under Linux 2.4. To take
      advantage of this, a recompilation under glibc-2.1.91 or
      later should suffice. (The kernel distinguishes old and new
      calls by an <code class="constant">IPC_64</code> flag in
      <em class="parameter"><code>cmd</code></em>.)</p>
    </div>

    <div class="refsect1">
      <a id="msgctl-2_sect6" name="msgctl-2_sect6" shape="rect"> </a>

      <h2>SEE ALSO</h2>

      <p><a class="link" href="../htmlman2/msgget.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">msgget</span>(2)</span></a>, <a class="link" href="../htmlman2/msgop.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">msgrcv</span>(2)</span></a>, <a class="link" href="../htmlman2/msgop.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">msgsnd</span>(2)</span></a>, <a class="link" href="../htmlman7/capabilities.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">capabilities</span>(7)</span></a>, <a class="link" href="../htmlman7/mq_overview.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mq_overview</span>(7)</span></a>, <a class="link" href="../htmlman7/svipc.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">svipc</span>(7)</span></a></p>
    </div>

    <div class="colophon">
      <a id="msgctl-2_sect7" name="msgctl-2_sect7" shape="rect"> </a>

      <h2>COLOPHON</h2>

      <p>This page is part of release 3.72 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man−pages/.</p>

      <div class="license">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>

          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright 1993 Giorgio Ciucci (giorgio<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>crcc.it)<br />

                  and Copyright 2004, 2005 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  <br />
                  %%%LICENSE_START(VERBATIM)<br />
                  Permission is granted to make and distribute verbatim copies of this<br />

                  manual provided the copyright notice and this permission notice are<br />

                  preserved on all copies.<br />
                  <br />
                  Permission is granted to copy and distribute modified versions of this<br />

                  manual under the conditions for verbatim copying, provided that the<br />

                  entire resulting derived work is distributed under the terms of a<br />

                  permission notice identical to this one.<br />

                  <br />
                  Since the Linux kernel and libraries are constantly changing, this<br />

                  manual page may be incorrect or out-of-date.  The author(s) assume no<br />

                  responsibility for errors or omissions, or for damages resulting from<br />

                  the use of the information contained herein.  The author(s) may not<br />

                  have taken the same level of care in the production of this manual,<br />

                  which is licensed free of charge, as they might when working<br />

                  professionally.<br />
                  <br />
                  Formatted or processed versions of this manual, if unaccompanied by<br />

                  the source, must acknowledge the copyright and authors of this work.<br />

                  %%%LICENSE_END<br />
                  <br />
                  Modified Tue Oct 22 08:11:14 EDT 1996 by Eric S. Raymond &lt;esr<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>thyrsus.com&gt;<br />

                  Modified Sun Feb 18 01:59:29 2001 by Andries E. Brouwer &lt;aeb<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>cwi.nl&gt;<br />

                  Modified, 27 May 2004, Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                      Added notes on CAP_IPC_OWNER requirement<br />

                  Modified, 17 Jun 2004, Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                      Added notes on CAP_SYS_ADMIN requirement for IPC_SET and IPC_RMID<br />

                  Modified, 11 Nov 2004, Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  Language and formatting clean-ups<br />

                  Added msqid_ds and ipc_perm structure definitions<br />

                  2005-08-02, mtk: Added IPC_INFO, MSG_INFO, MSG_STAT descriptions<br />
                  
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
